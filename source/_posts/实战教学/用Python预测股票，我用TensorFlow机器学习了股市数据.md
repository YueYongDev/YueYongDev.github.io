---
title: ä¸ºäº†é¢„æµ‹è‚¡ç¥¨ï¼Œæˆ‘ç”¨TensorFlowæ·±åº¦å­¦ä¹ äº†è‚¡å¸‚æ•°æ®
categories:
  - å®æˆ˜æ•™å­¦
tags:
  - TensorFlow
  - python
abbrlink: ffc6
cover: https://upload-images.jianshu.io/upload_images/5666077-a670bc7cf4e3b904.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240
---

> å®Œæ•´æºç å¯åœ¨å¾®ä¿¡å…¬ä¼—å·ï¼šã€Œ01 äºŒè¿›åˆ¶ã€åå°å›å¤ï¼šã€Œè‚¡å¸‚åˆ†æã€è·å–
>
> é˜…è¯»æ­¤æ–‡å‰å»ºè®®å…ˆé˜…è¯»[ã€Šæ‰¾å¯¹è±¡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ç«Ÿç„¶ç†è§£äº†ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼ã€‹](https://mp.weixin.qq.com/s/GVd7jxQH1_vXagBTBPvFdw)

## å‰è¨€

ç›¸ä¿¡å¤§å®¶è¿™å‡ å¤©æˆ–å¤šæˆ–å°‘çš„éƒ½å¼€å§‹å…³æ³¨åˆ°è‚¡å¸‚äº†ï¼Œè™½ç„¶æˆ‘è¿˜ä¸æ˜¯å¾ˆæ‡‚é‡Œé¢çš„ä¸€äº›å¥—è·¯ï¼Œä½†æ˜¯ä»æœ€è¿‘å„ä¸ªå…¬ä¼—å·çš„æ¨é€é‡Œé¢ï¼Œæˆ‘ä¹Ÿçœ‹åˆ°æœ€è¿‘çš„è‚¡å¸‚ç¡®å®æ˜¯å½¢åŠ¿å¤§å¥½ã€‚å¯¹å¾ˆå¤šäººæ¥è¯´ï¼Œè‚¡ç¥¨å°±å’Œæˆ¿ä»·ä¸€æ ·ï¼Œä»–çš„å‡ä¸é™ç‰µåŠ¨ç€ä¼—å¤šäººçš„å¿ƒã€‚è¿™å‡ å¤©å¾ˆå¤š qq ç¾¤ã€å¾®ä¿¡ç¾¤éƒ½å¼€å§‹è®¨è®ºèµ·è‚¡ç¥¨äº†ï¼Œå„ä½åŠé—´å¤§ç¥ä¹Ÿçº·çº·å¼€å§‹é¢„æµ‹å„ç§è‚¡ç¥¨èµ°åŠ¿äº†ã€‚

è‚¡ç¥¨ä»·æ ¼æ˜¯å…¸å‹çš„æ—¶é—´åºåˆ—æ•°æ®ï¼ˆç®€ç§°æ—¶åºæ•°æ®ï¼‰ï¼Œä¼šå—åˆ°ç»æµç¯å¢ƒã€æ”¿åºœæ”¿ç­–ã€äººä¸ºæ“ä½œå¤šç§å¤æ‚å› ç´ çš„å½±å“ï¼Œæ‰€ä»¥è¯´è‚¡ç¥¨ä»·æ ¼é¢„æµ‹æ˜¯ä¸€ä»¶éå¸¸å”¬äººçš„äº‹æƒ…ã€‚ä½†æ˜¯åŸºäºå†å²æ•°æ®ï¼Œä»¥è‚¡ç¥¨ä»·æ ¼ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•å¯¹æ—¶åºæ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œä»ç„¶å€¼å¾—ä¸€åšã€‚

ä¸è¿‡ä»Šå¤©æˆ‘ä»¬ä¸èŠè‚¡å¸‚ï¼Œå› ä¸ºæˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠèŠæˆ‘ä»¬çŸ¥é“çš„ä¸œè¥¿ã€‚å¦‚ä»Šæ·±åº¦å­¦ä¹ åœ¨é‡‘èå¸‚åœºçš„åº”ç”¨è¶Šæ¥è¶Šå¹¿æ³›ï¼Œæˆ‘ä»¬èƒ½å¦åˆ©ç”¨å·²æœ‰çš„å†å²æ•°æ®é€šè¿‡æ·±åº¦å­¦ä¹ çš„æ–¹å¼æ¥è¿›è¡Œé¢„æµ‹å‘¢ï¼Ÿ

## å‡†å¤‡å·¥ä½œ

ç­”æ¡ˆè‡ªç„¶æ˜¯å¯ä»¥çš„ï¼Œè™½ç„¶æˆ‘ä»¬æ— æ³•éå¸¸å‡†ç¡®çš„è¿›è¡Œé¢„æµ‹ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªæ·±åº¦å­¦ä¹ å…¥æ‰‹çš„é¡¹ç›®æ˜¯å®Œå®Œå…¨å…¨å¯ä»¥çš„ã€‚

### å®éªŒç¯å¢ƒ

è€æ ·å­ï¼Œä»¥å…å‡ºç°å› ç¯å¢ƒå¯¼è‡´çš„é—®é¢˜ï¼Œå…ˆå°†å®éªŒç¯å¢ƒåˆ—å‡ºï¼š

- MacOS 10.14.3
- Python 3.6.8ï¼ˆAnacondaï¼‰
- Jupyter Notebook
- ä½¿ç”¨çš„åŒ…æœ‰ï¼š
  - TensorFlow
  - Keras
  - matplotlib
  - pandas

### æ•°æ®

æ­¤æ¬¡å®éªŒï¼Œæˆ‘ä»¬é‡‡ç”¨**STATWORX**çš„`S&P 500`è‚¡ä»·æ•°æ®ï¼Œè¯¥æ•°æ®é›†çˆ¬å–è‡ª Google Finance APIï¼Œå·²ç»è¿›è¡Œè¿‡ç¼ºå¤±å€¼å¤„ç†ã€‚ä»–ä»¬çš„å®˜æ–¹ç½‘ç«™æ˜¯ï¼šhttps://www.statworx.com/ã€‚

> æ•°æ®é›†å¯åœ¨å¾®ä¿¡å…¬ä¼—å·ï¼šã€Œ01 äºŒè¿›åˆ¶ã€åå°å›å¤ï¼šã€Œè‚¡å¸‚æ•°æ®é›†ã€è·å–

#### æ•°æ®é¢„è§ˆ

åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ pandasï¼Œä¸»è¦ç”¨äºæ•°æ®æ¸…æ´—å’Œæ•´ç†

```python
import pandas as pd
data=pd.read_csv('data/data_stocks.csv')
data.info()
```

æ‰§è¡Œ`data.info()`å¯ä»¥æŸ¥çœ‹ç‰¹å¾çš„æ¦‚è¦ï¼š

```
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 41266 entries, 0 to 41265
Columns: 502 entries, DATE to NYSE.ZTS
dtypes: float64(501), int64(1)
memory usage: 158.0 MB
```

ä»ä¸Šè¿°ç»“æœå¯çŸ¥ï¼šè¯¥æ•°æ®é›†æ•°æ®å…± 502 åˆ—ï¼Œ41266 è¡Œï¼Œ502 åˆ—åˆ†åˆ«ä¸ºï¼š

- `DATE`ï¼šè¯¥è¡Œæ•°æ®çš„æ—¶é—´æˆ³
- `SP500`ï¼šå¯ä»¥ç†è§£ä¸ºå¤§ç›˜æŒ‡æ•°
- å…¶ä»–ï¼šå¯ä»¥ç†è§£ä¸º 500 æ”¯ä¸ªè‚¡çš„è‚¡ä»·

æŸ¥çœ‹æ•°æ®çš„å‰äº”è¡Œ

```python
data.head()
```

![](http://upload-images.jianshu.io/upload_images/5666077-ed6b751fb444ab46?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç»˜åˆ¶å¤§ç›˜è¶‹åŠ¿æŠ˜çº¿å›¾

```
plt.plot(data['SP500'])
```

ç»“æœå¦‚ä¸‹ï¼š

![](http://upload-images.jianshu.io/upload_images/5666077-06f54a1f77d5669a?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

> Tipsï¼šæ­¤æ¬¡å®éªŒçš„è°ƒè¯•ç¯å¢ƒä¸º Jupyter Notebookï¼Œæˆ‘ä»¬æœ€å¥½åœ¨å¼€å¤´å¯¼å…¥`matplotlib`åŒ…çš„æ—¶å€™åœ¨åŠ ä¸€è¡Œ`%matplotlib inline`ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ Jupyter Notebook ä¸­å†…åµŒç»˜å›¾ï¼Œå¹¶ä¸”çœç•¥æ‰ plt.show()è¿™ä¸€æ­¥ã€‚

#### æ•°æ®æ•´ç†

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒå’Œæµ‹è¯•æ•°æ®ã€‚åˆ†é…æ¯”ä¸º 8:2ï¼Œå³è®­ç»ƒæ•°æ®åŒ…å«æ€»æ•°æ®é›†çš„ 80ï¼…ã€‚å½“ç„¶åœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆå°†`DATE`è¿™ä¸ªæ— å…³å˜é‡èˆå»ã€‚

```
data.drop('DATE', axis=1, inplace=True)
data_train = data.iloc[:int(data.shape[0] * 0.8), :]
data_test = data.iloc[int(data.shape[0] * 0.8):, :]
```

æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„`shape`ï¼š

![](http://upload-images.jianshu.io/upload_images/5666077-6d5120d7e6fa9a10?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### æ•°æ®å½’ä¸€åŒ–

å°†å±æ€§ç¼©æ”¾åˆ°ä¸€ä¸ªæŒ‡å®šçš„æœ€å¤§å’Œæœ€å°å€¼ï¼ˆé€šå¸¸æ˜¯ï¼ˆ-1ï¼Œ1ï¼‰ï¼‰ä¹‹é—´ï¼Œè¿™å¯ä»¥é€šè¿‡`sklearn.preprocessing.MinMaxScaler`ç±»å®ç°ã€‚

ä½¿ç”¨è¿™ç§æ–¹æ³•çš„ç›®çš„åŒ…æ‹¬ï¼š

1. å¯¹äºæ–¹å·®éå¸¸å°çš„å±æ€§å¯ä»¥å¢å¼ºå…¶ç¨³å®šæ€§ã€‚

2. ç»´æŒç¨€ç–çŸ©é˜µä¸­ä¸º 0 çš„æ¡ç›®ã€‚

```python
scaler = MinMaxScaler(feature_range=(-1, 1))
scaler.fit(data_train)
data_train = scaler.transform(data_train)
data_test = scaler.transform(data_test)
```

## é¢„æµ‹

åœ¨æ­¤æ¬¡é¢„æµ‹è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡‡ç”¨ TensorFlow è¿™ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œå®ƒæ˜¯ç›®å‰é¢†å…ˆçš„æ·±åº¦å­¦ä¹ å’Œç¥ç»ç½‘ç»œè®¡ç®—æ¡†æ¶ã€‚è¿™ä¸€éƒ¨åˆ†æ¨è**æœ‰åŸºç¡€çš„äºº**é˜…è¯»ï¼Œåœ¨è¿™æ¨èæˆ‘è¿˜åœ¨æ•´ç†çš„[TensorFlow ç³»åˆ—](https://juejin.im/post/5c751da2f265da2dba022fd9)ï¼Œæœ‰å…´è¶£çš„å¯ä»¥äº†è§£ä¸‹ã€‚

è¿™é‡Œæˆ‘ä»¬éœ€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼š**ä½¿ç”¨å½“å‰æ—¶åˆ»çš„ 500 æ”¯ä¸ªè‚¡è‚¡ä»·ï¼Œé¢„æµ‹å½“å‰æ—¶åˆ»çš„å¤§ç›˜æŒ‡æ•°**ã€‚å³ä¸€ä¸ªå›å½’é—®é¢˜ï¼Œ**è¾“å…¥å…± 500 ç»´ç‰¹å¾ï¼Œè¾“å‡ºä¸€ç»´**ï¼Œå³`[None, 500] => [None, 1]`

### è®¾ç½® X ä¸ Y

```python
X_train = data_train[:, 1:]
y_train = data_train[:, 0]
X_test = data_test[:, 1:]
y_test = data_test[:, 0]
```

è¿™é‡Œçš„ x å’Œ y æ˜¯å·²ç»åˆ†ç±»å¥½çš„æ•°æ®é›†ï¼Œåªæ˜¯ç”¨ X å’Œ Y ä¸¤ä¸ªå˜é‡è¡¨ç¤ºï¼Œå¯ä»¥ç†è§£ä¸ºå‡½æ•°é‡Œé¢çš„ X å’Œ Yã€‚

### è®¾ç½®è¶…å‚æ•°

```python
input_dim = X_train.shape[1]
output_dim = 1
hidden_1 = 1024
hidden_2 = 512
hidden_3 = 256
hidden_4 = 128
batch_size = 256
epochs = 10
```

è¿™é‡Œæˆ‘ä»¬è®¾ç½®äº†å‡ ä¸ªè¶…å‚æ•°ï¼Œ`input_dim`è¡¨ç¤ºè¾“å…¥æ•°æ®çš„ç»´åº¦ï¼Œå³ 500ã€‚`output_dim`è¡¨ç¤ºè¾“å‡ºæ•°æ®çš„ç»´åº¦ï¼Œå³ 1ã€‚åœ¨è¯¥æ¨¡å‹ä¸­è®¾ç½®äº† 4 å±‚éšè—å±‚ï¼Œç¬¬ä¸€å±‚åŒ…å« 1024 ä¸ªç¥ç»å…ƒï¼Œç•¥å¤§äºè¾“å…¥å¤§å°çš„ä¸¤å€ã€‚ åç»­çš„éšè—å±‚æ€»æ˜¯å‰ä¸€å±‚çš„ä¸€åŠå¤§å°ï¼Œå³åˆ†åˆ«ä¸º 512,256 å’Œ 128 ä¸ªç¥ç»å…ƒã€‚ æ¯ä¸ªåç»­å±‚çš„ç¥ç»å…ƒæ•°é‡çš„å‡å°‘å‹ç¼©äº†ç½‘ç»œåœ¨å…ˆå‰å±‚ä¸­è¯†åˆ«çš„ä¿¡æ¯ã€‚ å½“ç„¶ï¼Œå…¶ä»–ç½‘ç»œæ¶æ„å’Œç¥ç»å…ƒé…ç½®ä¹Ÿæ˜¯å¯èƒ½çš„ï¼Œåªæ˜¯ç”±äºæœ¬æ–‡åªæ˜¯ä¸€ä¸ªå…¥é—¨çš„é¡¹ç›®æ‰€ä»¥å¹¶æœªæ·±ç©¶ã€‚

> åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œ**è¶…å‚æ•°**æ˜¯åœ¨å¼€å§‹å­¦ä¹ è¿‡ç¨‹ä¹‹å‰è®¾ç½®å€¼çš„å‚æ•°ï¼Œè€Œä¸æ˜¯é€šè¿‡è®­ç»ƒå¾—åˆ°çš„å‚æ•°æ•°æ®ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œéœ€è¦å¯¹è¶…å‚æ•°è¿›è¡Œä¼˜åŒ–ï¼Œç»™å­¦ä¹ æœºé€‰æ‹©ä¸€ç»„æœ€ä¼˜è¶…å‚æ•°ï¼Œä»¥æé«˜å­¦ä¹ çš„æ€§èƒ½å’Œæ•ˆæœã€‚

### è®¾ç½®å ä½ç¬¦ï¼ˆplaceholderï¼‰

```python
X = tf.placeholder(shape=[None, input_dim], dtype=tf.float32)
Y = tf.placeholder(shape=[None], dtype=tf.float32)
```

ä¸ºäº†é€‚åº”æˆ‘ä»¬çš„æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå ä½ç¬¦ï¼šXï¼ˆç¥ç»ç½‘ç»œçš„è¾“å…¥ï¼‰å’Œ Yï¼ˆç¥ç»ç½‘ç»œçš„è¾“å‡ºï¼‰ã€‚

### è®¾ç½®ç¥ç»ç½‘ç»œ

æ ¹æ®ä¹‹å‰è®¾ç½®å¥½çš„è¶…å‚æ•°è¿›è¡Œç¥ç»ç½‘ç»œçš„é…ç½®ï¼Œå…¶ä¸­**w**ä¸ºæƒé‡ï¼Œ**b**ä¸ºåç½®å€¼

```python
# ç¬¬ä¸€å±‚
W1 = tf.get_variable('W1', [input_dim, hidden_1], initializer=tf.contrib.layers.xavier_initializer(seed=1))
b1 = tf.get_variable('b1', [hidden_1], initializer=tf.zeros_initializer())
# ç¬¬äºŒå±‚
W2 = tf.get_variable('W2', [hidden_1, hidden_2], initializer=tf.contrib.layers.xavier_initializer(seed=1))
b2 = tf.get_variable('b2', [hidden_2], initializer=tf.zeros_initializer())
# ç¬¬ä¸‰å±‚
W3 = tf.get_variable('W3', [hidden_2, hidden_3], initializer=tf.contrib.layers.xavier_initializer(seed=1))
b3 = tf.get_variable('b3', [hidden_3], initializer=tf.zeros_initializer())
# ç¬¬å››å±‚
W4 = tf.get_variable('W4', [hidden_3, hidden_4], initializer=tf.contrib.layers.xavier_initializer(seed=1))
b4 = tf.get_variable('b4', [hidden_4], initializer=tf.zeros_initializer())
# è¾“å‡ºå±‚
W5 = tf.get_variable('W5', [hidden_4, output_dim], initializer=tf.contrib.layers.xavier_initializer(seed=1))
b5 = tf.get_variable('b5', [output_dim], initializer=tf.zeros_initializer())
```

äº†è§£è¾“å…¥å±‚ï¼Œéšè—å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´æ‰€éœ€çš„å˜é‡å°ºå¯¸éå¸¸é‡è¦ã€‚ä½œä¸ºå¤šå±‚æ„ŸçŸ¥å™¨(MLPï¼Œè¿™é‡Œä½¿ç”¨çš„ç½‘ç»œç±»å‹)çš„ä¸€ä¸ªç»éªŒæ³•åˆ™ï¼Œå‰ä¸€å±‚çš„ç¬¬äºŒç»´æ˜¯å½“å‰å±‚ä¸­æƒé‡çŸ©é˜µçš„ç¬¬ä¸€ç»´ã€‚è¿™å¯èƒ½å¬èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å®è´¨ä¸Šåªæ˜¯æ¯ä¸ªå›¾å±‚éƒ½å°†å…¶è¾“å‡ºä½œä¸ºè¾“å…¥ä¼ é€’åˆ°ä¸‹ä¸€å›¾å±‚ã€‚åå·®ç»´åº¦ç­‰äºå½“å‰å›¾å±‚çš„æƒé‡çŸ©é˜µçš„ç¬¬äºŒç»´åº¦ï¼Œå…¶å¯¹åº”äºè¯¥å±‚ä¸­çš„ç¥ç»å…ƒçš„æ•°é‡ã€‚

### è®¾ç½®ç½‘ç»œä½“ç³»ç»“æ„

åœ¨å®šä¹‰æ‰€éœ€çš„æƒé‡å’Œåç½®å˜é‡åï¼Œéœ€è¦æŒ‡å®šç½‘ç»œæ‹“æ‰‘ç»“æ„å’Œç½‘ç»œç»“æ„ã€‚å› æ­¤ï¼Œå ä½ç¬¦(æ•°æ®)å’Œå˜é‡(æƒé‡å’Œåç½®)éœ€è¦ç»„åˆæˆä¸€ä¸ªè¿ç»­çŸ©é˜µä¹˜æ³•ç³»ç»Ÿã€‚

```python
h1 = tf.nn.relu(tf.add(tf.matmul(X, W1), b1))
h2 = tf.nn.relu(tf.add(tf.matmul(h1, W2), b2))
h3 = tf.nn.relu(tf.add(tf.matmul(h2, W3), b3))
h4 = tf.nn.relu(tf.add(tf.matmul(h3, W4), b4))
out = tf.transpose(tf.add(tf.matmul(h4, W5), b5))
```

æ­¤å¤–ï¼Œç½‘ç»œçš„éšè—å±‚éœ€è¦è¢«æ¿€æ´»å‡½æ•°æ¿€æ´»ã€‚æ¿€æ´»å‡½æ•°æ˜¯ç½‘ç»œä½“ç³»ç»“æ„çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå› ä¸ºå®ƒä»¬å°†éçº¿æ€§å¼•å…¥åˆ°ç³»ç»Ÿä¸­ã€‚è¿™é‡Œé‡‡ç”¨æœ€å¸¸è§çš„ ReLU æ¿€æ´»å‡½æ•°ã€‚

ä¸‹å›¾è¯´æ˜äº†ç½‘ç»œæ¶æ„ã€‚ è¯¥æ¨¡å‹ç”±ä¸‰ä¸ªä¸»è¦æ„å»ºå—ç»„æˆã€‚ è¾“å…¥å±‚ï¼Œéšè—å±‚å’Œè¾“å‡ºå±‚ã€‚ è¯¥ä½“ç³»ç»“æ„ç§°ä¸ºå‰é¦ˆç½‘ç»œã€‚ å‰é¦ˆè¡¨ç¤ºè¯¥æ‰¹æ•°æ®ä»…ä»å·¦å‘å³æµåŠ¨ã€‚ å…¶ä»–ç½‘ç»œæ¶æ„ï¼Œä¾‹å¦‚é€’å½’ç¥ç»ç½‘ç»œï¼Œä¹Ÿå…è®¸æ•°æ®åœ¨ç½‘ç»œä¸­â€œå‘åâ€æµåŠ¨ã€‚

![](http://upload-images.jianshu.io/upload_images/5666077-404f59c387130323?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### è®¾ç½®æŸå¤±å‡½æ•°ï¼ˆloss functionï¼‰å’Œä¼˜åŒ–å™¨ï¼ˆOptimizerï¼‰

```python
loss = tf.reduce_mean(tf.squared_difference(out, Y))
optimizer = tf.train.AdamOptimizer().minimize(loss)
```

è¿™ä¸€éƒ¨åˆ†æ²¡å•¥å¥½è¯´çš„ï¼Œè®°ä½è¿™ä¹ˆå†™å°±å¯ä»¥äº†ï¼Œæƒ³äº†è§£çš„è¯å¯ä»¥å»[æˆ‘çš„ TensorFlow](https://juejin.im/post/5c751da2f265da2dba022fd9)ä¸­äº†è§£ä¸‹ã€‚

### æ‰§è¡Œè®­ç»ƒè¿‡ç¨‹

åœ¨å®šä¹‰å¥½ç¥ç»ç½‘ç»œçš„å ä½ç¬¦ï¼Œç»“æ„ï¼ŒæŸå¤±å‡½æ•°å‡½æ•°å’Œä¼˜åŒ–å™¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒäº†ã€‚è®­ç»ƒæ•°æ®é›†åˆ†ä¸º n / batch_size æ‰¹æ¬¡ï¼Œè¿™äº›æ‰¹æ¬¡æŒ‰é¡ºåºé€å…¥ç½‘ç»œã€‚ æ­¤æ—¶å ä½ç¬¦ X å’Œ Y å¼€å§‹èµ·ä½œç”¨ã€‚ å®ƒä»¬å­˜å‚¨è¾“å…¥å’Œç›®æ ‡æ•°æ®ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºè¾“å…¥å’Œç›®æ ‡å‘ˆç°ç»™ç½‘ç»œã€‚

æ•°æ® X åˆ†æ‰¹æ¬¡æµç»ç½‘ç»œï¼Œç›´åˆ°åˆ°è¾¾è¾“å‡ºå±‚ã€‚ åœ¨é‚£é‡Œï¼ŒTensorFlow å°†æ¨¡å‹é¢„æµ‹ä¸å½“å‰æ‰¹æ¬¡ä¸­å®é™…è§‚å¯Ÿåˆ°çš„ç›®æ ‡ Y è¿›è¡Œæ¯”è¾ƒã€‚ ä¹‹åï¼ŒTensorFlow è¿›è¡Œä¼˜åŒ–æ­¥éª¤å¹¶æ›´æ–°ä¸æ‰€é€‰å­¦ä¹ æ–¹æ¡ˆç›¸å¯¹åº”çš„ç½‘ç»œå‚æ•°ã€‚ æ›´æ–°äº†æƒé‡å’Œåå·®åï¼Œå¯¹ä¸‹ä¸€æ‰¹è¿›è¡Œé‡‡æ ·ï¼Œå¹¶é‡å¤è¯¥è¿‡ç¨‹ã€‚ è¯¥è¿‡ç¨‹å°†ç»§ç»­ï¼Œç›´åˆ°æ‰€æœ‰æ‰¹æ¬¡éƒ½å·²å‘ˆç°ç»™ç½‘ç»œã€‚å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œä¸€æ¬¡å…¨é¢æ‰«æè¢«ç§°ä¸ºä¸€ä¸ª**epochï¼ˆè½®ï¼‰**ã€‚

ä¸€æ—¦è¾¾åˆ°äº†æœ€å¤§æ•°é‡çš„ epochs æˆ–ç”¨æˆ·å®šä¹‰çš„å¦ä¸€ä¸ªåœæ­¢æ ‡å‡†ï¼Œç½‘ç»œçš„è®­ç»ƒå°±ä¼šåœæ­¢ã€‚

```python
with tf.Session() as sess:
    # åˆå§‹åŒ–æ‰€æœ‰å˜é‡
    sess.run(tf.global_variables_initializer())

    for e in range(epochs):
        # å°†æ•°æ®æ‰“ä¹±
        shuffle_indices = np.random.permutation(np.arange(y_train.shape[0]))
        X_train = X_train[shuffle_indices]
        y_train = y_train[shuffle_indices]

        for i in range(y_train.shape[0] // batch_size):
            start = i * batch_size
            batch_x = X_train[start : start + batch_size]
            batch_y = y_train[start : start + batch_size]
            sess.run(optimizer, feed_dict={X: batch_x, Y: batch_y})

            if i % 50 == 0:
                print('MSE Train:', sess.run(loss, feed_dict={X: X_train, Y: y_train}))
                print('MSE Test:', sess.run(loss, feed_dict={X: X_test, Y: y_test}))
                y_pred = sess.run(out, feed_dict={X: X_test})
                y_pred = np.squeeze(y_pred)
                plt.plot(y_test, label='test')
                plt.plot(y_pred, label='pred')
                plt.title('Epoch ' + str(e) + ', Batch ' + str(i))
                plt.legend()
                plt.show()
```

è¿è¡Œç»“æœä¸ºï¼š

```
MSE Train: 9.56518e-05
MSE Test: 0.0025863606
MSE Train: 6.0618047e-05
MSE Test: 0.0025002975
MSE Train: 0.00014856807
MSE Test: 0.0017371146
MSE Train: 0.00016200903
MSE Test: 0.0025396077
MSE Train: 0.00010259051
MSE Test: 0.0030134947
MSE Train: 7.979905e-05
MSE Test: 0.0023832247
MSE Train: 5.92488e-05
MSE Test: 0.0032762515
MSE Train: 8.747634e-05
MSE Test: 0.004848172
MSE Train: 8.5051965e-05
MSE Test: 0.0032768336
```

æœ€åæµ‹è¯•é›†çš„ loss åœ¨ 0.003 å·¦å³ï¼Œå¯ä»¥è¯´æ˜¯æ¯”è¾ƒç²¾ç¡®äº†ã€‚

å¯è§†åŒ–è®­ç»ƒç»“æœï¼š

![20190226203532](http://upload-images.jianshu.io/upload_images/5666077-58fa7bd9365e1b5b?imageMogr2/auto-orient/strip)

æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è¿›ä¸€æ­¥æ”¹å–„è¿™ä¸€ç»“æœï¼šå¢åŠ éšè—å±‚å’Œæ”¹è¿›ç¥ç»å…ƒçš„è®¾è®¡ï¼Œé€‰æ‹©ä¸åŒçš„åˆå§‹åŒ–å’Œæ¿€æ´»æ–¹æ¡ˆï¼Œæå‰åœæ­¢ç­‰ç­‰ã€‚ æ­¤å¤–ï¼Œä¸åŒç±»å‹çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä¾‹å¦‚å¾ªç¯ç¥ç»ç½‘ç»œï¼Œå¯ä»¥åœ¨æ­¤ä»»åŠ¡ä¸Šå®ç°æ›´å¥½çš„æ€§èƒ½ã€‚ ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯è¿™ç¯‡ä»‹ç»æ€§æ–‡ç« çš„èŒƒå›´ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡ŒæŸ¥æ‰¾èµ„æ–™ã€‚

## ç»“è®º

æ­£å¦‚å¼€å¤´æ‰€è¯´ï¼Œè‚¡ç¥¨çš„ä»·æ ¼ä¼šå—åˆ°ç»æµç¯å¢ƒã€æ”¿åºœæ”¿ç­–ã€äººä¸ºæ“ä½œå¤šç§å¤æ‚å› ç´ çš„å½±å“ï¼ŒçœŸæ­£æƒ³è¦é¢„æµ‹è‚¡å¸‚èµ°å‘å•é è¿™ç¯‡æ–‡ç« é‡Œé¢æ‰€å™è¿°çš„è¿œè¿œä¸å¤Ÿï¼Œæœ¬æ–‡æ—¨åœ¨ç»“åˆæ—¶ä¸‹çƒ­ç‚¹è¿›è¡Œä¸€æ¬¡æœ‰å…³ TensorFlow çš„æŠ€æœ¯æ¨èã€‚

TensorFlow çš„å‘å¸ƒæ˜¯æ·±åº¦å­¦ä¹ ç ”ç©¶ä¸­çš„ä¸€ä¸ªé‡Œç¨‹ç¢‘äº‹ä»¶ã€‚ä½œä¸ºä¸€ä¸ªå­¦ç”Ÿï¼Œç¬”è€…ä¹Ÿåœ¨ç§¯æçš„å­¦ä¹ ä¸­ï¼Œæœ‰å…´è¶£å­¦ä¹ çš„å°ä¼™ä¼´å¯ä»¥åœ¨å…¬ä¼—å·åå°ï¼ˆå°±æ˜¯æ–‡æœ«çš„é‚£ä¸ªå…¬ä¼—å·ï¼‰å›å¤ã€Œ**TensorFlow è§†é¢‘**ã€è·å–ä¸€ä»½è´¨é‡è¾ƒé«˜çš„ TensorFlow è§†é¢‘ï¼Œä¹Ÿå¯ä»¥æ·»åŠ æˆ‘çš„å¾®ä¿¡ä¸€èµ·äº¤æµè¿›æ­¥ã€‚

> å®Œæ•´æºç å¯åœ¨å¾®ä¿¡å…¬ä¼—å·ï¼šã€Œ01 äºŒè¿›åˆ¶ã€åå°å›å¤ï¼šã€Œè‚¡å¸‚åˆ†æã€è·å–

**å‚è€ƒèµ„æ–™**

- [ä½¿ç”¨ TensorFlow è¿›è¡Œè‚¡ç¥¨ä»·æ ¼é¢„æµ‹çš„ç®€å•æ·±åº¦å­¦ä¹ æ¨¡å‹](https://vimsky.com/article/3847.html)
- [æ·±åº¦æœ‰è¶£ | 10 è‚¡ç¥¨ä»·æ ¼é¢„æµ‹](https://blog.csdn.net/zhl493722771/article/details/82779315)

---

â€œä¸‡æ°´åƒå±±éƒ½æ˜¯æƒ…ï¼Œç»™ä¸ªå…³æ³¨è¡Œä¸è¡Œ ğŸ‘‡â€

![](http://upload-images.jianshu.io/upload_images/5666077-218fabb971dad637?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
